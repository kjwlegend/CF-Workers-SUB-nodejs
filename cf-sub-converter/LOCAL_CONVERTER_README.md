# æœ¬åœ°è®¢é˜…è½¬æ¢å™¨ (Local Subscription Converter)

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²å®Œå…¨é‡æ„ï¼Œ**ç§»é™¤äº†å¯¹å¤–éƒ¨ subconverter æœåŠ¡çš„ä¾èµ–**ï¼Œå®ç°äº†å®Œå…¨æœ¬åœ°åŒ–çš„è®¢é˜…è½¬æ¢åŠŸèƒ½ã€‚åŸºäº ACL4SSR è§„åˆ™é›†ï¼Œæ”¯æŒå¤šç§åè®®å’Œè¾“å‡ºæ ¼å¼ã€‚

## ğŸš€ ä¸»è¦ç‰¹æ€§

### âœ… å®Œå…¨æœ¬åœ°åŒ–

- **æ— å¤–éƒ¨ä¾èµ–**ï¼šä¸å†ä¾èµ–ç¬¬ä¸‰æ–¹ subconverter æœåŠ¡
- **é«˜å¯ç”¨æ€§**ï¼šé¿å…å¤–éƒ¨æœåŠ¡é™åˆ¶å’Œæ•…éšœ
- **å¿«é€Ÿå“åº”**ï¼šæœ¬åœ°å¤„ç†ï¼Œå“åº”é€Ÿåº¦æ›´å¿«
- **éšç§ä¿æŠ¤**ï¼šè®¢é˜…æ•°æ®ä¸ä¼šå‘é€åˆ°å¤–éƒ¨æœåŠ¡

### âœ… å¤šåè®®æ”¯æŒ

- **VMESS**: V2Ray åè®®
- **VLESS**: V2Ray æ–°åè®®
- **Trojan**: Trojan åè®®
- **Shadowsocks**: SS åè®®
- **Hysteria**: æ–°ä¸€ä»£åè®®

### âœ… å¤šæ ¼å¼è¾“å‡º

- **Base64**: åŸå§‹ Base64 ç¼–ç æ ¼å¼
- **Clash**: åŸºäº ACL4SSR è§„åˆ™çš„ Clash é…ç½®
- **Sing-box**: Sing-box JSON é…ç½®
- **Surge**: Surge é…ç½®æ–‡ä»¶
- **QuantumultX**: QuantumultX é…ç½®
- **Loon**: Loon é…ç½®æ–‡ä»¶

### âœ… æ™ºèƒ½è§„åˆ™

- **åŸºäº ACL4SSR**: ä½¿ç”¨æˆç†Ÿçš„ ACL4SSR è§„åˆ™é›†
- **è‡ªåŠ¨åˆ†æµ**: æ™ºèƒ½åˆ†æµä¸­å›½å¤§é™†å’Œæµ·å¤–æµé‡
- **å¹¿å‘Šæ‹¦æˆª**: å†…ç½®å¹¿å‘Šå’Œæ¶æ„ç½‘ç«™æ‹¦æˆª
- **æœåŠ¡ä¼˜åŒ–**: é’ˆå¯¹å¾®è½¯ã€è‹¹æœã€è°·æ­Œç­‰æœåŠ¡ä¼˜åŒ–

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
src/lib/
â”œâ”€â”€ converters/
â”‚   â”œâ”€â”€ clash-config.ts      # Clashé…ç½®ç”Ÿæˆå™¨
â”‚   â””â”€â”€ local-converter.ts   # æœ¬åœ°è½¬æ¢æœåŠ¡
â”œâ”€â”€ parsers/
â”‚   â””â”€â”€ proxy-parser.ts      # åè®®è§£æå™¨
â””â”€â”€ ...
```

### è½¬æ¢æµç¨‹

```mermaid
graph TD
    A[è®¢é˜…å†…å®¹] --> B[æ•°æ®æ¸…ç†]
    B --> C[åè®®è§£æ]
    C --> D[æ ¼å¼æ£€æµ‹]
    D --> E[æœ¬åœ°è½¬æ¢]
    E --> F[è§„åˆ™åº”ç”¨]
    F --> G[è¾“å‡ºé…ç½®]
```

## ğŸ“ ä»£ç é‡æ„äº®ç‚¹

### 1. ç§»é™¤ä¸­æ–‡å˜é‡å

```typescript
// æ—§ä»£ç  (ä¸­æ–‡å˜é‡)
let è®¢é˜…æ ¼å¼ = 'base64'
let è‡ªå»ºèŠ‚ç‚¹ = ''
let è®¢é˜…é“¾æ¥ = ''

// æ–°ä»£ç  (è‹±æ–‡å˜é‡)
let subscriptionFormat: SupportedFormat = 'base64'
let selfBuiltNodes = ''
let subscriptionLinks = ''
```

### 2. æ¨¡å—åŒ–è®¾è®¡

```typescript
// åè®®è§£æå™¨
export function parseVmess(vmessUrl: string): ParsedProxy | null
export function parseVless(vlessUrl: string): ParsedProxy | null
export function parseTrojan(trojanUrl: string): ParsedProxy | null

// æœ¬åœ°è½¬æ¢å™¨
export class LocalConverter {
  static async convert(
    content: string,
    format: SupportedFormat
  ): Promise<string>
}
```

### 3. ç±»å‹å®‰å…¨

```typescript
export type SupportedFormat =
  | 'base64'
  | 'clash'
  | 'singbox'
  | 'surge'
  | 'quanx'
  | 'loon'

export interface ParsedProxy {
  protocol: string
  name: string
  server: string
  port: number
  [key: string]: any
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### ACL4SSR è§„åˆ™ç»„

- ğŸš€ èŠ‚ç‚¹é€‰æ‹©
- â™»ï¸ è‡ªåŠ¨é€‰æ‹©
- ğŸŒ å›½å¤–åª’ä½“
- ğŸ“² ç”µæŠ¥ä¿¡æ¯
- â“‚ï¸ å¾®è½¯æœåŠ¡
- ğŸ è‹¹æœæœåŠ¡
- ğŸ“¢ è°·æ­Œ FCM
- ğŸ¯ å…¨çƒç›´è¿
- ğŸ›‘ å…¨çƒæ‹¦æˆª
- ğŸƒ åº”ç”¨å‡€åŒ–
- ğŸŸ æ¼ç½‘ä¹‹é±¼

### æ”¯æŒçš„ URL å‚æ•°

- `?clash` - å¼ºåˆ¶ Clash æ ¼å¼
- `?sb` æˆ– `?singbox` - å¼ºåˆ¶ Sing-box æ ¼å¼
- `?surge` - å¼ºåˆ¶ Surge æ ¼å¼
- `?quanx` - å¼ºåˆ¶ QuantumultX æ ¼å¼
- `?loon` - å¼ºåˆ¶ Loon æ ¼å¼
- `?b64` æˆ– `?base64` - å¼ºåˆ¶ Base64 æ ¼å¼

## ğŸš¦ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬è®¢é˜…

```
https://your-domain.com/your-token
```

### 2. æŒ‡å®šæ ¼å¼

```
https://your-domain.com/your-token?clash
https://your-domain.com/your-token?singbox
https://your-domain.com/your-token?surge
```

### 3. User-Agent è‡ªåŠ¨æ£€æµ‹

ç³»ç»Ÿä¼šæ ¹æ®å®¢æˆ·ç«¯ User-Agent è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æ ¼å¼ï¼š

- Clash å®¢æˆ·ç«¯ â†’ Clash æ ¼å¼
- Sing-box å®¢æˆ·ç«¯ â†’ Sing-box æ ¼å¼
- Surge å®¢æˆ·ç«¯ â†’ Surge æ ¼å¼
- å…¶ä»– â†’ Base64 æ ¼å¼

## ğŸ” è°ƒè¯•åŠŸèƒ½

### æµè§ˆå™¨è®¿é—®é‡å®šå‘å·²ç¦ç”¨

ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œç°åœ¨æµè§ˆå™¨è®¿é—®ä¸ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°ç¼–è¾‘é¡µé¢ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹è½¬æ¢ç»“æœã€‚

### è¯¦ç»†æ—¥å¿—

ç³»ç»Ÿæä¾›è¯¦ç»†çš„è½¬æ¢æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š

- åè®®è§£æç»“æœ
- æ ¼å¼æ£€æµ‹è¿‡ç¨‹
- è½¬æ¢æˆåŠŸ/å¤±è´¥ä¿¡æ¯
- èŠ‚ç‚¹ç»Ÿè®¡æ•°æ®

## ğŸ› ï¸ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°åè®®æ”¯æŒ

1. åœ¨ `proxy-parser.ts` ä¸­æ·»åŠ è§£æå‡½æ•°
2. åœ¨ `local-converter.ts` ä¸­æ·»åŠ è½¬æ¢é€»è¾‘
3. æ›´æ–°ç±»å‹å®šä¹‰

### æ·»åŠ æ–°è¾“å‡ºæ ¼å¼

1. åœ¨ `SupportedFormat` ç±»å‹ä¸­æ·»åŠ æ–°æ ¼å¼
2. åœ¨ `LocalConverter.convert()` ä¸­æ·»åŠ å¤„ç†é€»è¾‘
3. å®ç°æ ¼å¼ç‰¹å®šçš„è½¬æ¢å‡½æ•°

## ğŸ“Š æ€§èƒ½ä¼˜åŠ¿

| ç‰¹æ€§     | å¤–éƒ¨è½¬æ¢å™¨    | æœ¬åœ°è½¬æ¢å™¨    |
| -------- | ------------- | ------------- |
| å“åº”é€Ÿåº¦ | æ…¢ (ç½‘ç»œå»¶è¿Ÿ) | å¿« (æœ¬åœ°å¤„ç†) |
| å¯ç”¨æ€§   | ä¾èµ–å¤–éƒ¨æœåŠ¡  | 100%å¯ç”¨      |
| éšç§æ€§   | æ•°æ®å¤–ä¼       | å®Œå…¨æœ¬åœ°      |
| è‡ªå®šä¹‰æ€§ | å—é™          | å®Œå…¨å¯æ§      |
| ç»´æŠ¤æ€§   | ä¾èµ–ç¬¬ä¸‰æ–¹    | è‡ªä¸»ç»´æŠ¤      |

## ğŸ¯ æœªæ¥è®¡åˆ’

- [ ] æ”¯æŒæ›´å¤šåè®® (Hysteria2, TUIC ç­‰)
- [ ] ä¼˜åŒ–è§„åˆ™é›†æ›´æ–°æœºåˆ¶
- [ ] æ·»åŠ é…ç½®æ¨¡æ¿ç³»ç»Ÿ
- [ ] å®ç°è®¢é˜…å†…å®¹ç¼“å­˜
- [ ] æ”¯æŒè‡ªå®šä¹‰è§„åˆ™é›†

---

**æ³¨æ„**: æœ¬ç³»ç»Ÿå·²å®Œå…¨ç§»é™¤å¤–éƒ¨ subconverter ä¾èµ–ï¼Œæ‰€æœ‰è½¬æ¢å‡åœ¨æœ¬åœ°å®Œæˆï¼Œç¡®ä¿äº†é«˜å¯ç”¨æ€§å’Œæ•°æ®å®‰å…¨æ€§ã€‚
